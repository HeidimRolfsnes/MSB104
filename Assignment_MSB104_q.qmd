---
title: "Assignment MSB104"
author: "Heidi Marie Rolfsnes and Ann Elisabeth Jacobsen"
data: today
bibliography: [Reference.bib]

format:
  html:
    toc: true
    toc-depth: 2
    toc-location: left
    code-fold: true
---

```{r Packages}
#| warning: false
#| echo: false
# <<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<
# CLEAN UP #####################################################################
#<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<
# Clear environment ; # Remove all add-ons ; # Clear console
if (!require("pacman")) install.packages("pacman")
pacman::p_load(pacman)
rm(list = ls()) ; p_unload(all) ; cat("\014")
# Clear mind :)
#<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<
# INSTALL AND LOAD PACKAGES ####################################################
#<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<

suppressMessages(library(tidyverse))
suppressMessages(library(lubridate))
suppressMessages(library(tibble))
suppressMessages(library(readr))
suppressMessages(library(knitr))
suppressMessages(library(dplyr))
suppressMessages(library(dineq))
suppressMessages(library(magrittr))
suppressMessages(library(vtable))
suppressMessages(library(wooldridge))
suppressMessages(library(huxtable))
suppressMessages(library(lmtest))
suppressMessages(library(rstatix))
suppressMessages(library(car))
suppressMessages(library(jtools))
suppressMessages(library(tinytex))
suppressMessages(library(stargazer))
suppressMessages(library(plm))

```

## Introduction hei hå

In the subject MSB104 econometrics, this year we will hand in an
assignment divided into four tasks throughout the semester. The
assignments must be written and calculated in the software R. We are
group one and the countries that will be representing in our assignment
is: Denmark, France, Hungary, Portugal and Slovakia. We started by
downloading datasets from Eurostat that we needed to use in the
assignment. We then calculated GDP per capita and wrote about
descriptive statistics. We have looked at and calculated regional
inequity, growth and inequity and other determinants of inequity. We
have taken various tests to find/or see if there are large differences
and to see if there is, for example, heteroskedasticity. Along the way,
we have discussed various graphs, models and findings. Finally, we have
looked a bit at fixed effects using panel data.

### 1. Sub-national GDP

The data sets contain GDP (nama_10r_3gdp) and population
(demo_r\_pjanaggr3,pi) for our five countries over the last 20 years, on
a NUTS3 level.

```{r Dataset GDP and rename obs_value, time_period and geo}
#| echo: false
BNP <- read.csv("Dataset/nama_10r_3gdp.csv")
BNP <- BNP %>%
  select(geo, TIME_PERIOD, OBS_VALUE, unit) %>%
      rename(GDP = "OBS_VALUE",Year = "TIME_PERIOD", Region = "geo") 

Pop <- read.csv("Dataset/Population.csv")
Pop <- Pop %>%
    select(geo, TIME_PERIOD, OBS_VALUE) %>%
      rename(Population = "OBS_VALUE",Year = "TIME_PERIOD", Region = "geo") 
```

We would like to have the information we get from these two data sets
collected in one data set. A new data set called gdppop has been created
and is the data set that will be used further in the task.

```{r Make one datset with GDP and Population}
#| echo: false
gdppop <- BNP %>%  left_join(Pop, by = c("Region", "Year"))
```

Further in the assignment, we will need three new variables that we will
collect as new data sets from Eurostat. The first data set is education,
were we want to look at the amount of people who have higher education.
We can use this to see if education has any effect on Gini in the
different regions. In the second dataset we will look at transport. Find
out how many motorways there is in kilometres, and use this to see if it
has something to say on the Gini. In the third, called demographic
datasets, we want to look at life expectancy age. Life expectancy age
can we use to see if there is a young or an aging population. We will
use this to look at the effect on Gini.

```{r Data set Education }
#| echo: false
Education <- read_csv('Dataset/education.csv',show_col_types = FALSE )
Education <- Education %>%
  select(unit,isced11,geo,age,TIME_PERIOD,OBS_VALUE) %>%
  filter(unit=="PC" & isced11=="ED0-2" & age=="Y25-64" & (grepl('DK..', geo) | grepl('FR..', geo) | grepl('HU..', geo)| grepl('PT..', geo) | grepl('SK..', geo))) %>%
  mutate(Edu = OBS_VALUE, Year=TIME_PERIOD, nuts2=geo) %>%
  select(nuts2, Year, Edu)
```

```{r Data set Motorways}
#| echo: false
Transport <- read_csv('Dataset/Transport.csv',show_col_types = FALSE )%>%
  mutate(Road=OBS_VALUE, Year=TIME_PERIOD, nuts2=geo) %>%
  select(nuts2, Year, Road)
```

```{r Data set life expectancy age }
#| echo: false
Lifeexp <- read_csv('Dataset/Life.csv' ,show_col_types = FALSE) %>%
mutate(lea = OBS_VALUE, Year = TIME_PERIOD, nuts2=geo) %>%
  select(nuts2, Year, lea)
```

#### 1.1 GDP per capita

GDP per capita means how much the GDP divide between the population and
to calculate GDP per capita, we use the formula:
$$ y_i = GDP_i / population_i$$ The litle i refers to nuts3 regions in
our countries.

```{r Calculate GDP per capita}
#| echo: false
gdppop <- gdppop  %>%
mutate(gdp_per_capita =   GDP/Population*1000000) %>%
na.omit()
#NA variables are remove
```

To create an overview of GDP per capita in our nuts3 regions, we use
descriptive statistics. We can look at descriptive statistics by using
numbers, like in our table @tbl-1 . A descriptive statistic contains the
min and the max values. i.e. the smallest and the highest GDP per capita
for the countries. We can find first quartile and third quartile. The
first quartile is the observation between the median and the lowest
value, and looks at the 25% lowest values from the 75% highest. The
median looks at the value that is observed the most times in the middle
of the observations. The third quartile is then, naturally enough, the
value between the median and the highest value. It also shows mean which
tells us what the average observation for all regions are.

In @tbl-1 we get an overview of GDP, population and GDP per capita for
all the nuts3 regions. The mean of GDP per capita for all nuts3 regions
are 22 588 euro per capita. The smallest value are 4394,85 Euro per
capita and the highest are 92 361,75 Euros per capita.

GDP is about the economy of each individual country. It tells us
something about how the economy is developing in the various country. It
is calculated from all goods and services produced in the country in a
given year and subtracted from the products or services used in this
production **SSB**

As previously mentioned, we have been allocated five countries, where we
will, among other things, look at the population. Populations means the
people who live in these countries or within the geographical regions,
like nuts2 regions.

It is not easy to draw any conclusion from the summary in @tbl-1, as we
assume that there are large regional inequities between the regions in
the countries we have in our sample.

To get a more defined picture of the various regions and see if any of
them stand out, we want to divide the countries up, with the exception
of Hungary and Slovakia. They both have few regions, so we choose to
look at them together. By looking at the countries separately, we will
hopefully get a better overview of outliers in the various countries. We
first look at how GDP per capita has developed over the past 20 years.
In order to be able to compare the countries in a given period we choose
to only look at the year 2010. When we look at a specific year and
country we can look at GDP per capita and see differences in the
different regions. If there are large deviations in some of the regions,
we can possibly remove them so that the differences are not too large.

#### 1.2.1 Denmark

Denmark is not a particularly large country in Europe, nor does it have
many nuts3 regions @fig-1. Copenhagen which is the capital of Denmark,
and the regions around Copenhagen, are the ones that stand out.
Furthermore, we will also see that it is the capitals that are often the
richest regions.

Based on @tbl-2, we can see that the three richest regions in Denmark in
2010 are Copenhagen (DK011), Copenhagen area (DK012) and Sydjylland
(DK032). On @tbl-3 we can see that the three poorest regions in Denmark
in 2010 are Vest- og Sydjælland (DK022), Bornholm (DK014) and
Østsjælland (DK021). Between the poorest people in Østsjælland and the
richest people in Copenhagen, there is a difference of more than 30,000
Euro per capita.

#### 1.2.2 France

France is a country in southern Europe with over 100 nuts3 regions. Some
of these regions are colonies in other parts of the world. It is not
easy to distinguish the different regions. @fig-2 shows us that it is
the capital, Paris in France that stands out. Based on the summary in
@tbl-4 , we can see that there is a difference between min and max. If
we look more closely at the figures, it is possible to see that the
reason may be that France has colonies in other countries that are
included. These colonies are in Africa and South America which has a
negative effect on France's overall GDP. For further research, we have
chosen to remove these regions from the data set.

After the FRY regions have been removed in @fig-3, we are left with 96
nuts3 regions. When we have removed the FRY regions, we see that there
are some regions that stand out, but all the others seem to follow each
other in that the curve moves equally over the years.

Based on @tbl-6 the three richest regions in 2010 are Paris (FR101),
Hauts-de-seine (FR105) and Rhône (FRK26). Paris og Hauts-de-seine stands
out clearly from the other region with a difference of approximately
50,000 Euro pr capita. The three poorest regions in 2010 is Creuse
(FRI22), Ariège (FRJ21) and Meuse(FRF32)@tbl-7. In these regions we find
little variation in gdp per capita. Between the Paris and Meuse there is
a difference of over 74,000 Euro per capita. It looks like there is a
greater between rich and poor in France than in Denmark. An assumption
could be that since France has a lot more regions then Denmark some of
the regions in France can be very small compared to the few regions in
Denmark.

#### 1.3.3 Hungary and Slovakia

Hungary and Slovakia are both countries in Central Europe. As we can se
on @fig-4 both Bratislava and Budapest had a good growth until 2008.
After the growth in 2008, we see that the curve goes down for a period
with Bratislava. At the same time Budapest had a larger increase. The
other regions in these countries have had more stable growth.

Together, Hungary and Slovakia have 28 regions. In @tbl-8 The three
richest regions in 2010 are Bratislava (SK010), Budapest (HU110) and
Trnava (SK021). This refers to what we have commented on previously
countries that the capital cities are often the richest regions when we
look at gdp per capita. In @tbl-9 it shows that the poorest regions in
year 2010 are Nògràd(HU313), Szabolcs-Szatmàr-Bereg(HU323). All the
poorest regions belong to Hungary, which may mean that Hungary has a
lower GDP per capita than Slovakia.

There is a difference of approximately 25,000 Euro per capita between
the richest and poorest regions in Hungary in 2010. Based on these
observations, the capital Bratislava is the richest region. Since we do
not see any of Slovakia's regions among the lowest, we can assume
Slovakia has a higher GDP per capita than Hungary has for its
inhabitants.

#### 1.2.4 Portugal

Portugal is a country in southern Europe. Portugal has two archipelagos,
each representing a different region. In @fig-5 we can see that there is
a steady growth in the regions, but all regions have had a slight
decline between 2010-2012. After 2012, it appears that all regions have
increase again.

Portugal has 25 regions. @tbl-10 shows us that the three richest regions
in 2010 are Lisboa(PT170), Alentejo Litoral (PT181) and Algarve (PT150).
Lisboa has a litle higher GDP pr capita than the rest of the wealthiest
regions. In @tbl-11 we can see that the three poorest regions in 2010
are Tãmega e Sousa (PT11C), Alto Tãmega (PT11B) and Beiras e Serra da
Estrela (PT16J). There is approximately 14,000 Euro per capita, in
difference between the richest and the poorest regions in Portugal.

In all the countries, we see that it is the capitals that stand out the
most and have the highest GDP per capita among their inhabitants. Paris
has the highest GDP per capita and the poorest regions are to be found
in Hungary.

### 2. Regional inequality

Regional inequality is seen together with economic growth. In many
countries, economic growth affects the regions by, for example,
increasing migration to the big cities. It will affect the smaller
regions in that the number of inhabitants are reduced and jobs are lost.
In addition to geography and unemployment, it can also apply to
population growth, education, and investments, which in turn apply to
both state and private investments.

Regional inequality can be measured using Gini coefficients. We create
the Gini coefficient by using this formula

$$ GINW_j=\frac{1}{2 \bar{y_j}} \sum_{i}^{n_j}\sum_{l}^{n_j}\frac{p_i}{P_j} \frac{p_l}{P_j} |y_i-y_l| $$

A Gini coefficient must be between 0 and 1. If it's 0, it means that
there is little inequality, and if it's closer to 1, it means that there
is a greater degree of inequality between rich and poor. We calculate a
Gini coefficient by looking at how much wealth and income there is in a
country and then how it is distributed among the population. When we
have calculated the Gini coefficients, we will also run a test on the
data we have to see if we find outliers. Outliers are values that are
either very high or very low compared to the other data we have.

#### 2.1 Gini for all countries

```{r Gini for all countries }
#| echo: false
#Nuts 2 id
gdppop %<>%  
  mutate(nuts2 = substr(Region,1,4)) 
#Nuts 1 id
gdppop %<>%  
  mutate(nuts0 = substr(Region,1,2))
#gen weighted gini
#for all
gini.wtd(gdppop$gdp_per_capita, w = gdppop$Population)

gdppop <- gdppop %<>% 
   group_by(nuts2, Year) %>%
  mutate(gini_n2= gini.wtd(gdp_per_capita, w = Population)) %>%
  ungroup() # to remove grouping

```

When we look at all the nuts2 regions in the selected countries, we have
46 observations. The total Gini for all countries in 2010 is 0.28.
Looking at all the countries together does not give an answer that says
much. We also want to look at the countries individually. When we look
at the countries separately, we will also be able to see who has a Gini
of 0 - which means whether they have a perfect correlation. We will
first look at how the Gini has evolved over the last 20 years before we
again just look at Gini for 2010.

#### 2.1.1 Denmark

In @fig-6, there are two regions in Denmark that have varied quite a bit
over the past 20 years. They still stay below 0.025, which shows us that
there is just a small difference between rich and poor in these regions.
A region that really stands out is DK01. It is a bit further up the
graph than the other regions. Although it is not close to 0, there is a
greater difference between rich and poor here than in the other regions.

As we can see in @tbl-12 the Gini coefficients are between 0 and 0,11 in
Denmark. In @tbl-13 Denmark has a region, DK05 which is an outlier. In
this region we don't have much data so the little data we get gives us a
perfect Gini of 0. Denmark has only five nuts2 regions, and it doesn't
gives us much data to work with.

#### 2.1.2 France

France is a bit different from Denmark with a lot of regions. In @fig-7
there are so many regions that we are unable to see them properly. What
is shown well is that the vast majority of regions follow each other
evenly by being below 0.1. There are still some regions that stand out
and we can see that FR10 stands the most out with a Gini of 0.3, while
FRJ1 and FRK1 fluctuate quite a bit from 2005 to 2020.

In France, the @tbl-14 shows that the Gini coefficients are between 0,02
and 0,26. France has a slightly higher Gini than Denmark, which means
that the inequality is slightly greater in France. Without the FRY
regions the @tbl-15 shows that France doesn´t have any outliers.

#### 2.1.3 Hungary and Slovakia

In @fig-8 Hungary and Slovakia have large fluctuations in their regions
. One of the regions with the most fluctuations is HU22 where they are
down to a Gini of 0.075 in 2012, while in 2016 they are up to a Gini of
approximately 0.12. Hungary and Slovakia are small countries in Eastern
Europe and we assume that this is the reason why there are large
fluctuations.

When we look at the @tbl-16 the Gini coefficient in Hungary is between 0
and 0,085 . Based on @tbl-18 Hungary has two regions, Budapest (HU11)
and Pest (HU12) which are outliers. Looking at the year 2010, Budapest
and Pest do not have any data that we can look at.

@tbl-17 tells us that in Slovakia, the Gini coefficient are between 0
and 0,081. Slovakia has one region called SK01 as we can see in @tbl-18,
that is an outlier. Then we are left with three regions from which we
can obtain data in Slovakia. The reason why we combined Hungary and
Slovakia further up in the task was precisely that they also had few
regions at the nuts3 level, in the same way that they also have now have
few nuts2 levels.

#### 2.1.4 Portugal

In the @fig-9 for Portugal, we can see that the Gini in several of the
regions have been declining over the past 20 years. That is to say, the
differences between rich and poor have narrowed over the years. PT18
stands out somewhat in that there are strong fluctuations over the
years.

Based on @tbl-19 Portugal has their Gini coefficient between 0 and 0,08.
Portugal has four regions that are outliers, Algarve (PT15)
Lisboa(PT17), Regiäo Autònoma dos Acores (PT20) and Regiäo Autònoma da
Madeira (PT30). Regiäo Autònoma dos Acores and Regiäo Autònoma da
Madeira is both archipelagos, belonging to Portugal which may be the
reason why they are outliers as we can see in @tbl-20. Portugal doesn't
have many nuts2 regions, and when four of them have no data, there is
not much confidence in the result we get.

#### 2.2 Noteworthy outliers

We have calculated GDP per capita for all the countries combined and per
country we have been given. We saw that when we collected all the
countries we got 22,805.13 Euros per capita. Denmark had a significantly
higher GDP per capita than the other countries. Hungary had the lowest
with only 8781.69. France has colonies in other continents, we chose to
remove these regions, this so that GDP would not be affected by these
regions that belong to other continents. When we took away the FRY
regions, there was no outliers in France, but we do find in all the
other countries. A noteworthy outliner is a value that stands out
greatly.

All the regions that are outliners are regions that have only one
province. In Hungary, Slovakia, and Portugal (HU11, HU12, SK01, PT15 and
PT 17) the outliers are linked to the capitals. Capitals are often large
areas, which only have one region. Portugal also has two island groups
(PT20 and PT30) that come up as outliers. The last region with outliers
is found in Denmark (DK05), this is a small region. What we find
noteworthy in outliers it may be in Denmark, cause all the others are
linked to the capitals. It is also special that France does not have any
outliers.

### 3. Growth and inequality

Next, we will be looking at growth and inequality in the countries at
nuts2 regions. We will also include more variables to see if there are
other conditions that affect growth in GDP per capita.

```{r GDP per capita for nuts 2}
#| echo: false
gdppop2010 <- gdppop %>%
  mutate(nuts2 = substr(Region,1,4))%>%
  group_by(nuts2, Year) %>%
  mutate(Gini = gini.wtd(gdp_per_capita, w = Population),
         gdp_n3 = sum(GDP, na.rm=T),
         pop_n3 = sum(Population, na.rm=T)) %>%
  mutate(gdp_n2 = sum(gdp_n3),pop_n2 = sum(pop_n3))%>%
  ungroup() %>%
  #Keeping only 1 obs per NUTS 2
    distinct(Year, nuts2,Gini,gdp_n2,pop_n2) %>%
  mutate(gdp_per_capita = gdp_n2/pop_n2*1000000)
```

Moving forward we will make linear models (lm) and a form of regression
that is simple. A simple regression model will show us the relationship
between two variables. By using this model, we can find the Y value when
X = 0 [@lander2014r] s. 265).

The Gini value goes from 0 to 1. Where 0 is a perfect equality and 1 is
inequality. When the Gini is 0, it is likely to believe there is missing
some data for 2010. Further we will use filter to take away the Gini´s
who are zero.

In @fig-10 we can see how the Gini is distributed per country. France
has one point that stands out from the others, while the other most
countries have their scores between 0 and 0.1. After we divided the
countries into nuts2 regions, we see that the countries, apart from
France do not have that many observations. we therefore choose too only
look at all the countries together or France in further tests.

```{r}
#| echo: false
# creating a function to when we are calculating linear regression model
lm_function_plot <- function(lmdata){
  lm_gdppc <- lm(Gini ~ gdp_per_capita, data = lmdata)
  b1_gdppc <- lm_gdppc$coefficients[1]
  b2_gdppc <- lm_gdppc$coefficients[2]

  # create plot for l.reg. model
  lmdata %>%
    ggplot(aes(x =gdp_per_capita, y=Gini, fill=nuts2, color=nuts2, label=nuts2)) +
    geom_point(lwd = .8) +
    geom_text(hjust=-0.3, vjust=0, check_overlap = FALSE) +
    geom_abline(intercept = b1_gdppc, slope = b2_gdppc, color="red", size=0.8) + 
    labs(x = "(GDP per capita)", y = "Gini")
}

# create function to calculate linear regression model
lm_residuals_plot <- function(lmdata){
  lm_gdppc <- lm(Gini ~ gdp_per_capita, data = lmdata)
  b1_gdppc <- lm_gdppc$coefficients[1]
  b2_gdppc <- lm_gdppc$coefficients[2]

  lmdata$predicted <- predict(lm_gdppc)
  lmdata$residuals <- residuals(lm_gdppc)
  
  # create plot for l.reg. model
  lmdata %>%
    ggplot(aes(x =gdp_per_capita, y=Gini, fill=nuts2, color=nuts2)) +
    geom_point(lwd = .8) +
    geom_segment(aes(xend=gdp_per_capita,yend=predicted)) +
    geom_abline(intercept = b1_gdppc, slope = b2_gdppc, color="red", size=0.8) + 
    labs(x = "(GDP per capita)", y = "Gini")
}
```

When we calculate regional development against regional inequality, we
use the values we have found in Gini and GDP per capita. To estimate the
effect between a regional development and regional inequality we can use
the formula:

$$ Regional inequality_i = \beta_1 + \beta_2Regional development_i+u_i$$

This equation tells us what the regional inequality will be when the
regional development is = 0 The slope of the curve will show us how much
inequality will change for each increase in development. If we increase
regional development by 1, regional inequality will increase by 1.

In the @fig-11 we look at the relationship between Gini and GDP per
capita in 2010 for all countries. The graph shows that the points are
above and below the regression line. There is a point on the right that
stand out significantly which tells us that the region has increased
more than the other regions**.** When we look at the grey field, it
tells us if we take the same test a thousand times, the blue regression
line will always be within the grey field.

In this regression we will look at the impact regional development (X)
has on regional inequality (Y). This means how much an increase in X
will have on an increase in Y. We use Gini as Y and GDP per capita as X.

```{r New variables}
#| echo: false
gdppop2010 <- gdppop2010 %>%
left_join(Education, by = c("Year", "nuts2" ))%>%
left_join(Lifeexp, by = c("nuts2", "Year"))%>%
left_join(Transport, by = c("nuts2", "Year"))%>%
  #economic development = (gdp_per_capita)
  mutate(nuts0 = substr(nuts2,1,2)) %>%
filter(Year == 2010)
```

```{r}
#| echo: false
gdppop2010 <- gdppop2010%>%
  filter(Gini > 0)%>%
mutate(Gini2 = Gini * 10000)
Denmark2010 <- gdppop2010 %>%
  filter(nuts0=="DK") 
France2010 <- gdppop2010 %>%
  filter(nuts0=="FR")
HungarySlovakia2010 <- gdppop2010 %>%
 filter(grepl('HU..', nuts2) | grepl('SK..', nuts2))
Portugal2010 <- gdppop2010 %>%
  filter(nuts0=="PT")


lm.1 = lm(Gini2 ~ gdp_per_capita, data = France2010)
lm.2 = lm(Gini2 ~ gdp_per_capita, data = gdppop2010)

#Gen Table
  huxreg(
  list( "France" = lm.1, "All" = lm.2),
  statistics = c(N = "nobs", R2 = "r.squared"),
  coefs = c(Const. = "(Intercept)", gdp_per_capita = "gdp_per_capita"),
  stars = c("*" = 0.1, "**" = 0.05, "***" =0.01),
  note = "Note): {stars} T statistics in brackets."
  )
```

In this model we see that France has 22 observations and an R2 that is
81.4%, which means that a large part of the increase in GINI has a
connection with an increase in GDP per capita. When we look at all
countries together we see that we have 38 observations and that R2 is
only 12.2%. which means there is less correlation between an increase in
Gini and an increase in GDP per capita. Both Gini's have three stars,
which means that we can trust the effect.

#### 3.1 Goodness of fit model

Looking at the simple regression that we have made, it is R2 that can
help us explain whether the variables have any relationship with each
other. R2 tells us how much spread we have in the independent variable.
The value in R2 can be between 0 and 1. When R2 is 1 it tells us that
the independent variable has all the influence on the dependent
variable. If it is 0, the independent variable has no influence on the
dependent variable [@johannessen2004forskningsmetode] .s.345

```{r}
#| echo: false
France2010 <- France2010 %>%
  filter(nuts2 != 'FR10') 
#removing Paris from France2010
```

By carrying out a regression analysis, we get a line that gives us an
overview of where the best hits are made. Residuals show the distance to
the line of best fit. There can be both positive and negative residuals.
If the value is above the line, it is positive and if it is below the
line it is negative.

```{r Residuals for all countries}
#| echo: false
#| label: fig-12
#| fig-cap: "Residuals for all countries"
lm_residuals_plot(gdppop2010) +
  labs(title = "Residuals for all countries")
```

Looking at all the countries together, we can see that the regression
line has both positive and negative hits on the line. The regions in
each country is close to each other except from France and Denmark which
are a little more spread out on the line. Hungary, Portugal and
Slovakia, except one, only have positive residuals. France has a lot
more regions and it looks like there are only a few positive ones.
Considering that there is a big difference in observations in each
country, France is probably the most reliable here as well, with
definitely most observations.

```{r Residuals for France }
#| echo: false
#| label: fig-13
#| fig-cap: "Residuals for France"
lm_residuals_plot(France2010) +
labs(title = "Residuals for France")
```

When we look closer at France, there is 21 observations, when we remove
Paris. With several observations it makes France more trustworthy then
the other countries. When we separate France in a separate graph, we can
see that some of the regions in France stand out. It will always be best
if the points follow the lines, i.e. are on the line. In France, we can
see that the regions are either above the line or below the line. This
means that there is great variation between the regions. When we compare
the two graphs above, we see that France has a steeper line. A steeper
line tells us that small changes in GDP have a large effect on Gini.

#### 3.2 The classical OLS assumptions

For linear regression there are seven OLS assumptions that are
classical. To produce the best estimates, we usually use the first six
assumptions.

-   Linearity: The regression model is linear in the coefficients and
    the error term When we look at all the countries it is close to
    linear, but when we look at France who have the most nuts2 regions,
    the regions either is above or under the line.
-   No Perfect collinaerity: The error term has a population mean of
    zero We can see that there are variations in the X variable both in
    France and in all the countries combined, which may indicate that we
    have fulfilled the second requirement for OLS
-   Random sampling: All independent variables are uncorrelated with the
    error term. The third assumption is about having a random dataset,
    even if we have made changes such as removing regions in France, we
    will still say that we have a random dataset based on the
    population.
-   Exogeneity: Observations of the error term are uncorrelated with
    each other. We do not have homoscedasticity, which means that the
    error term has the same variation in the independent variable. This
    is the most difficult to test for. In this assignment, we look at
    the effect X has on Y, but we do not look to see if there are other
    variables that influence on X.
-   Homoscedasticity: The error term has a constant variance (no
    heteroscedasticity). When we look at the graph over all the
    countries @fig-12, the variations of the error term should be
    constant on both sides of the regression line and no one should be
    far from the line, both sides should look the same. When we look
    only at France @fig-13, we see that the differences are smaller. We
    do not see complete homoscedasticity in France, but it is more
    moderate than when we look at all the countries.
-   Normality: The error term is normally distributed (optional). In our
    data, we see among some of the countries, example Denmark has only 5
    observations at the nuts2 level, while France has 22 observations.
    We cannot imagine that Denmark has enough observations to obtain a
    natural normal distribution, which could make us worried about error
    terms in relation to normal distribution. France, which has 22
    observations, we think have a large enough sample for a normal
    distribution, but the optimum would have been to have a larger data
    set.

### 4. Other determinants of inequity

We have chosen to look at kilometres, education, and life expectancy age
to see if there are other determinants of inequity. Our hypothesis is
that these variables should have a positive effect on the Gini, and that
we can see that an increase in these variables will also have an
increase in the Gini.

In a multiple linear regression model, we use several variables to see
the effect of an increase in Gini (Y). We can use the formula:

$$
Y_i = \beta_0 + \beta_1X_{1i} + \beta_2X_{2i}+... + \beta_kX_{ki}+u_i
$$

In the @tbl-24 regression model, France has 21 observations, such tests
gives the best results the more observations we have. R2 tells us
something about whether the variables have an influence on the dependent
variable or not. If the values have an increase for each new model, this
tells us that we have a connection. If the value decreases, they will
say that there is no connection between these variables. In our case, we
can see that R2 rises right up to the last model with all variables. We
end up with a R2 which says that 41,2% of the change in Gini can be
attributed to these variables. In the first row we can see the effect
GDP per capita and education has on Gini. It is only GDP per capita that
gets significant stars, which means that we can only say that an
increase in this variable has a positive effect on Gini. In the rows
with road and life expectancy age, we can see that GDP per capita gets a
significant star. When we look at all the countries together, we can't
find any significant stars, which means that combinations of these
variables do not have a particular effect on a possible increase in the
Gini.

France was the only country with many observations in 2010, therefore we
only tested the new variables in this country. We wanted to find out
whether education, the number of km of motorway and life expectancy had
an effect on inequalities in France and about these variables have a
connection with how prosperous the various regions are. after we carried
out this regression, we cannot say that these variables had any
particular effect on the Gini.

We wanted to see if variable education, motorways, and life expectancy
had a connection with growth and inequality in France in 2010. Based on
the test we carried out, we found no particular connection between these
variables. we conducted some simple tests to see if there was any
relationship between the Gini and these new variables. When we look in
@tab-21 about education we see a p value of 12.8%. We can then say that
there is a small connection between Gini and education. On the variables
life expectancy @tab-22 and motorway @tab-23 we only found small
P-values, which means little correlation between Gini and these
variables. What we like to know are if people with higher education
would like to move to more central places where the job opportunities
are greater. It can often be reflected in the fact that we find higher
Gini values in the bigger cities.

### 5. Test if the effect of development is significantly different for different subsets of countries in your data set

```{r dummy variabel}
#| echo: false
gdppop2010$Fra <- ifelse(gdppop2010$nuts0 == "FR", 1,0)
gdppop2010$Oth <- ifelse(gdppop2010$nuts0 == "FR", 0,1)
```

To test the effect of differences for the different subgroups of
countries, we have created the dummy variable. In a regression we cannot
use country as a variable, but if we turn the countries into dummy
variables, we get opportunities to filter on the countries. We have
converted France to 1 and the remaining countries to 0. Then we can look
at the regions in France as one and the other countries as another one.
We can see if there are differences between those who are living in
France and for those who live in the other countries. As we can see in
@tbl-25, we have 38 observations in total, 22 of the observation belongs
to France and the other 16 observations belongs to the other countries.
It is not a lot of observations in total.

Only France shows the effect for France only. No France shows the effect
for the other countries and will not include France. Interaction shows
for all countries and iteration of development with France dummy. Using
this, it is possible to see that Only France has a very high R2, and
they have three significant stars, which means that an increase in Gini
can be explained by an increase in GDP per capita. When we look at No
France, we find little correlation between an increase in Gini and an
increase in GDP per capita. We can also look at this when we see that R2
is only 0.001. We cannot see any relationship between these variables.

Interaction looks at all the observations with interaction for dummy
France: It has a high significant level on several of the variables,
which means that an increase in the Gini will also increase GDP per
capita. We can say this with 67.5% certainty.

In Only France and the interaction, we can see that we have a P-value
that is 0. It is lower than all of our significant levels. We have to
retain the null hypothesis. But we can doubt that the P-value is zero.
It is very unlikely, and we can´t say that there is any pattern, but
rather a random coincidence which means that we get zero in P-value.

No France has a P-value of 0.905. It is a high value, and we retain the
null hypothesis. It is still possible to doubt whether this is a pattern
or a random connection, since R2 is so low. As mentioned earlier, we do
have few observations, and few observations can have an impact on the
result.

### 6. Explore alternative functional forms

We will now make two new tests with different arguments, just to see if
we can get data that fits better. In both tests we choose to do a level
log test. In the first alternative model, we used log on the variables.
Log means that large variations in the observations will have less
impact on the results

```{r}
#| echo: false
gdppop2010 <- gdppop2010
lm.23 = lm(Gini2 ~ log(gdp_per_capita), filter(gdppop2010, Fra==1))
lm.24 = lm(Gini2 ~ log(gdp_per_capita), filter(gdppop2010, Fra==0))
lm.25 = lm(Gini2 ~ log(gdp_per_capita)*Fra, gdppop2010)
 
#Gen Table
  huxreg(
  list("Only France (log)" = lm.23, "No France (log)" = lm.24, "Interaction (log)" = lm.25),
  statistics = c("N" = "nobs",
      R2 = "r.squared", "F statistic" = "statistic",
      "P value" = "p.value"),
   stars = c("*" = 0.1, "**" = 0.05, "***" =0.01),
  note = "Note: {stars} T statistics in brackets."
  )
```

In the first test, it shows that only France still has a high
significant level of its variables and R2 is at 79.5%. It means that an
increase in Gini will also result in an increase in GDP per capita. Now,
we can see that France has an increase in Gini compared to the previous
test. And it has a slight increase in R2 to 0.9%. Interaction has the
same increase in Gini as No France and we see that we have a
significance level of 66.1%.

```{r}
gdppop2010 <- gdppop2010
lm.26 = lm(Gini2 ~ I(log(gdp_per_capita)), filter(gdppop2010, Fra==1))%>%
coeftest(vcov = hccm, save = TRUE)
 
lm.27 =lm(Gini2 ~ log(gdp_per_capita) + I(log(gdp_per_capita)^2), filter(gdppop2010, Fra==1)) %>%
  coeftest(vcoc = hccm, save= TRUE)
 
lm.28 = lm(Gini2 ~ log(gdp_per_capita)+ I(log(gdp_per_capita)^2)+I(log(gdp_per_capita)^3), filter(gdppop2010, Fra==1)) %>%
  coeftest(vcoc = hccm, save= TRUE)
 
#Gen Table
  huxreg(
  list("Only France (log)" = lm.26, "Only France (log) ^2" = lm.27, "Only France (log) ^3" = lm.28),
  statistics = c("N" = "nobs",
      R2 = "r.squared", "F statistic" = "statistic",
      "P value" = "p.value"),
   stars = c("*" = 0.1, "**" = 0.05, "***" =0.01),
  note = "Note: {stars} T statistics in brackets."
  )
```

In the second option, we only look at Only France and we use log (GDP
per capita) in the second and third square, and in addition we use
France's dummy variables. This gives us a reduction in Gini when we
raise to the second square and a large increase in Gini when we raise to
the third square. When we look at R2 there is a increase from 79.5% on
the first model to 81.9% on the last model.

```{r,  echo=TRUE, include=TRUE}
#plot
filter(gdppop2010, Fra==1) %>%
  ggplot(aes(x = log(gdp_per_capita), y = Gini2)) +
  geom_point(color = "darkslategray", size = 3) +
  stat_function(color = "red", fun=function(x) lm.28[[1,1]]+lm.28[[2,1]]*x+lm.28[[3,1]]*x*x+lm.28[[4,1]]*x*x*x)+
  theme_gray () + xlab("Log GDP per capita") + ylab("GINI")
```

In this Scatterplot there is 22 observations in France. In this plot we
see how the coefficients are distributed. The x-axis shows log GDP per
capita. The y-axis shows the Gini. Most of the points are located in the
lower part of the plot. We have a point that stands out, with a much
higher value. We suspect that the point that stands out is Paris as this
has been shown in previous tests, but we can't say for sure. The points
move upwards with the line which means positive correlation.

Next, we are going to test for heteroscedasticity, we will use the
Breusch-Pagan test. This test considers into account that the errors are
normally distributed [@wooldridge2015introductory]. We can make a
hypothesis by using this formula.

$$
\begin{aligned}
H_{0}:& \operatorname{Var}\left(u \mid x_{1}, x_{2}, \ldots, x_{k}\right)=\operatorname{Var}(u \mid \mathbf{x})=\sigma^{2} \\
&\operatorname{Var}(u \mid \mathbf{x})=E\left(u^{2} \mid \mathbf{x}\right)-[E(u \mid \mathbf{x})]^{2}=E\left(u^{2} \mid \mathbf{x}\right) \\
&\Rightarrow E\left(u^{2} \mid x_{1}, \ldots, x_{k}\right)=E\left(u^{2}\right)=\sigma^{2} \\
&\text{The mean of } u^2 \text{must not vary with } x_{1}, \ldots, x_{k}
\end{aligned}
$$

to test for heteroskedasticity we can use this estimate

$$\begin{aligned}& \widehat{u}^{2}=\delta_{0}+\delta_{1} x_{1}+\cdots+\delta_{k} x_{k}+\text { error } \\& H_{0}: \delta_{1}=\delta_{2}=\ldots=\delta_{k}=0 \end{aligned}$$

```{r,  echo=TRUE, include=TRUE}
#Estimate
reg <- lm(Gini2 ~ (gdp_per_capita),data = gdppop2010)
# Breusch-Pagan test F-Test (LM estimator)
bptest(reg)$p.value
```

The first test is Gini and GDP per capita. We do get a BP value of
0.0035. This is lower than 0.01. We then want to reject $H_0$ Hence we
facing Heteroskedasticity!

```{r,  echo=TRUE, include=TRUE}
#Estimate
reg<-lm(Gini2 ~ log(gdp_per_capita), filter(gdppop2010, Fra==1))
# Breusch-Pagan test F-Test (LM estimator)
bptest(reg)$p.value
```

The second test is Gini and log GDP per capita, and we have filtered on
France. We got a BP value of 0.672. This is higher than 0.10. We then
can't reject $H_0$.

```{r,  echo=TRUE, include=TRUE}
#Estimate
reg <- lm(Gini2 ~ log(gdp_per_capita),data = gdppop2010)
# Breusch-Pagan test F-Test (LM estimator)
bptest(reg)$p.value
```

The third test is Gini and log GDP per capita. We got a BP value of
0.0413. That is higher than 0.01. Then we can´t reject $H_0$ With a
P-value = 0,04131447. We can not reject $H_0$ (homoskedasticity).

To estimate the causal effect, we can carry out regression models. Just
to see if the variables we are working with incluence on each other. In
this section, we have carried out three different tests. Based on the
tests we cannot say with certainty that an increase in GDP per capita
has an effect on the Gini. Based on some of the tests, there are very
likely that it has an effect on the Gini. Anyhow, we cannot say if it is
the only reason.

### 7. Penal Estimates

Panel data are data collected over a time period with equal frequency
and where the same variables are used. Panel data can help us look at
trends and developments over time. We have therefore gone back to using
the first data set that we created so that we once again have all the
observations with us. In @tbl-26 we have used the panel estimates to see
the GDP per capita over time with fixed effects. The fixed effects we
have looked at are nuts2 regions, country, and year. We have 995
observations and we can there are not a very high R2 on any of these
models. We do find three significant stars on both the second and fourth
models.

Regio fixed effect says something about the regional effects on GDP per
capita over time. as we can see in \@tbl26 we see very little effect
over time. which is also supported by a low R2 of only 0.2%. Year FE
says something about the effect over time. here we see that R2 is 6.8%
which and we see that we have 3 significant stars which means that we
can rely on this effect with great certainty. When we look at Regio and
year together we again find a low R2 of only 0.4%, we also have no
significant stars so we can say that the combination of these will have
a very low effect on GDP per capita. in the last model we have Country
and year. here we see that the effect is much greater, we have an R2 of
34.1% and three significant stars, which means that over time we see a
greater effect on countries and years than on the other combinations.

## **Conclusion**

Through this assignment, we have looked at regional inequity, growth and
inequity and other determinants of inequity. We have used Gini and GDP
per capita to find answers. In most of the tests we have carried out, we
have rejected $H_0$, which may indicate that an increase in Gini and GDP
per capita have a connection. We have not found anything to suggest that
increases in these variables are only dependent on each other. Therefore
we think it is fair to say that it is very unlikely that these increases
are only dependent on each other.

We have looked at the relationship between Gini and GDP per capita. In
most of the tests we have carried out, we have seen that an increase in
the Gini also results in an increase in GDP per capita, but we have not
found anything to suggest that all increases can be due to the
connection between these variables. We have seen a positive correlation
and that our variables have a positive effect on each other. We have
previously said that the Gini coefficient represents the difference
between wealthy and poor, so we can probably say that rich people tend
to have the opportunity to educate themselves more than poor people, and
that there is often more drive in areas with more educated people, which
perhaps is reflected when it comes to the GDP in the same areas.

Through this assignment, we have seen that there are differences between
the countries when it comes to GDP and GINI, but also the size of the
countries and population. According to our observations, Denmark,
Portugal and France appear as wealthier countries, while Hungary and
Slovakia is at the other end of the scale. All these countries are part
of the EU, so if they had chosen to invest in a region for development,
this could have had a greater effect on the poor countries than it had
on the wealthier countries.

In the thesis, we have looked at the variables life expectancy,
education and kilometres/transport. The effect of these variables has
varying results. Other variables we can look at that may have an effect
on the Gini are the different health benefits in the countries, wage
levels and unemployment. If there is high unemployment in the countries,
we imagine that this could have a negative effect on the Gini.

## References

::: {#refs}
:::

## Appendix

**Assignment 1**

#### Table 1

```{r}
#| echo: false
#| output: true
#| label: tbl-1
#| tbl-cap: "Main data descriptive statistics 2010"

gdppop %>%
    filter(Year==2010) %>%
  select(GDP,Population,gdp_per_capita)%>%
  st()
```

#### Figure 1

```{r GDP in Denmark}
#| echo: false
#| label: fig-1
#| fig-cap: "GDP per capita in Denmark"

gdppop%>%
     filter(grepl("DK...", Region)) %>%
     select(Year, gdp_per_capita, Region) %>%
     ggplot(aes(x = Year, y= gdp_per_capita, fill= Region, color= Region)) +
     geom_point(lwd = .8) +
   labs(title = 'GDP per capita in Denmark', x = "Year", y = "GDP Per capita") 
```

#### Table 2

```{r the whealtiest regions in Denmark}
#| echo: false
#| output: true
#| label: tbl-2
#| tbl-cap: "The wealthiest regions in Denmark"
gdpdk <- gdppop%>%
  filter(grepl("DK...", Region)) %>%
  filter(Year==2010) %>%
  select(Year, Region, gdp_per_capita)
slice_max(gdpdk, gdp_per_capita, n=3)
```

#### Table 3

```{r The poorest regions in Denmark}
#| echo: false
#| output: true
#| label: tbl-3
#| tbl-cap: "The least wealthiest regions in Denmark"
slice_min(gdpdk, gdp_per_capita, n=3)

```

#### Figure 2

```{r GDP in France}
#| echo: false
#| label: fig-2
#| fig-cap: "GDP per capita in France"
gdppop%>%
     filter(grepl("FR...", Region)) %>%
     select(Year, gdp_per_capita, Region) %>%
     ggplot(aes(x = Year, y= gdp_per_capita, fill= Region, color= Region)) +
     geom_point(lwd = .8) +
   labs(title = 'GDP per capita in France', x = "Year", y = "GDP Per capita")
```

#### Table 4

```{r}
#| echo: false
#| output: true
#| label: tbl-4
#| tbl-cap: "Mean FR"
gdppop%>%
  filter(grepl("FR...", Region)) %>%
  select(Population, gdp_per_capita) %>%
  summary()
```

#### Table 5

```{r Take away the FRY regions}
#| echo: false
#| output: true
#| label: tbl-5
#| tbl-cap: "Take away the FRY region"
gdppop <- gdppop %>%
  filter(Region != 'FRY10') %>%
   filter(Region != 'FRY20') %>%
   filter(Region != 'FRY30') %>%
   filter(Region != 'FRY40') %>%
   filter(Region != 'FRY50') 

#trenger ikke være en tabell for den tar bare bort FRY regionene skulle kanskje vert i teksten heller.
```

#### Figure 3

```{r France without the FRY regions}
#| echo: false
#| label: fig-3
#| fig-cap: "France without FRY regions"
gdppop%>%
     filter(grepl("FR...", Region)) %>%
     select(Year, gdp_per_capita, Region) %>%
     ggplot(aes(x = Year, y= gdp_per_capita, fill= Region, color= Region)) +
     geom_point(lwd = .8) +
   labs(title = 'GDP per capita in France', x = "Year", y = "GDP Per capita")
```

#### Table 6

```{r}
#| echo: false
#| output: true
#| label: tbl-6
#| tbl-cap: "The wealthiest regions in France"
gdpfr <- gdppop %>%
  filter(grepl("FR...", Region)) %>%
  filter(Year==2010) %>%
  select(Year, Region, gdp_per_capita)
slice_max(gdpfr, gdp_per_capita, n=3)
```

#### Table 7

```{r}
#| echo: false
#| output: true
#| label: tbl-7
#| tbl-cap: "The least wealthiest regions in France"
slice_min(gdpfr, gdp_per_capita, n=3)
```

#### Figure 4

```{r GDP in Hungary and Slovakia}
#| echo: false
#| label: fig-4
#| fig-cap: "GDP per capita in Hungary and Slovakia"
gdppop %>%
     filter (grepl('HU..', Region) | grepl('SK..', Region)) %>%
     select(Year, gdp_per_capita, Region) %>%
     ggplot(aes(x = Year, y= gdp_per_capita, fill= Region, color= Region)) +
     geom_point(lwd = .8) +
   labs(title = 'GDP per capita in Hungary and Slovakia ', x = "Year", y = "GDP Per capita")
```

#### Table 8

```{r }
#| echo: false
#| output: true
#| label: tbl-8
#| tbl-cap: "The wealthiest regions un Hungary and Slovakia"
gdphusk <- gdppop%>%
  filter(grepl('HU..', Region) | grepl('SK..', Region)) %>%
  filter(Year==2010) %>%
  select(Year, Region, gdp_per_capita) 
slice_max(gdphusk, gdp_per_capita, n=3)
```

#### Table 9

```{r The poorest regions in Hungary and Slovakia}
#| echo: false
#| output: true
#| label: tbl_9
#| tbl-cap: "The least wealthiest regions in Hungary and Slovakia"
slice_min(gdphusk, gdp_per_capita, n=3)
```

#### Figure 5

```{r GDP in Portugal}
#| echo: false
#| label: fig-5
#| fig-cap: "GDP per capita in Portugal"
gdppop%>%
     filter(grepl("PT...", Region)) %>%
     select(Year, gdp_per_capita, Region) %>%
     ggplot(aes(x = Year, y= gdp_per_capita, fill= Region, color= Region)) +
     geom_point(lwd = .8) +
   labs(title = 'GDP per capita in Portugal', x = "Year", y = "GDP Per capita") 
```

#### Table 10

```{r}
#| echo: false
#| output: true
#| label: tbl-10
#| tbl-cap: "The wealthiest regions in Portugal"
gdppt <- gdppop%>%
  filter(grepl("PT...", Region)) %>%
  filter(Year==2010) %>%
  select(Region, gdp_per_capita)
slice_max(gdppt, gdp_per_capita, n=3)
```

#### Table 11

```{r}
#| echo: false
#| output: true
#| label: tbl-11
#| tbl-cap: "The least wealtiest regions in Portugal"
slice_min(gdppt, gdp_per_capita, n=3)
```

#### Figure 6

```{r NUTS2 in Denmark}
#| echo: false
#| label: fig-6
#| fig-cap: "nuts2 in Denmark"
gdppop %>%
filter(nuts0 == "DK") %>%
distinct(nuts2, Year,.keep_all =TRUE) %>%
ggplot(aes(x = Year, y=gini_n2, fill=nuts2, color=nuts2)) +
  geom_line(lwd = .8) +
   labs(title = 'Nuts 2 - Gini in Denmark', x = "Year", y = "Gini")
```

#### Table 12

```{r}
#| echo: false
#| output: true
#| label: tbl-12
#| tbl-cap: "Gini in DK regions"
gdppop %>%
filter(nuts0 == "DK") %>%
select(Year,nuts2, gini_n2) %>%
distinct(nuts2, Year,.keep_all =TRUE) %>%
  filter(Year==2010)
```

#### Table 13

```{r Outliers in Denmark}
#| echo: false
#| output: true
#| label: tbl-13
#| tbl-cap: "TOutliers in Denmark"
dkoutliers <- gdppop %>%
  filter(nuts0 == "DK") %>%
  filter(gini_n2==0) %>%
  distinct(nuts2)
dkoutliers
```

#### Figure 7

```{r NUTS2 in France}
#| echo: false
#| label: fig-7
#| fig-cap: "Nuts2 in France"
gdppop %>%
filter(nuts0 == "FR") %>%
distinct(nuts2, Year,.keep_all =TRUE) %>%
ggplot(aes(x = Year, y=gini_n2, fill=nuts2, color=nuts2)) +
  geom_line(lwd = .8) +
   labs(title = 'Nuts 2 - Gini in France', x = "Year", y = "Gini") 

```

#### Table 14

```{r}
#| echo: false
#| output: true
#| label: tbl-14
#| tbl-cap: "Gini in France"
gdppop %>%
filter(nuts0 == "FR") %>%
select(Year,nuts2, gini_n2) %>%
distinct(nuts2, Year,.keep_all =TRUE) %>%
  filter(Year==2010)
```

#### Table 15

```{r}
#| echo: false
#| output: true
#| label: tbl-15
#| tbl-cap: "Outliers in France"
froutliers <- gdppop %>%
  filter(nuts0 == "FR") %>%
  filter(gini_n2==0) %>%
  distinct(nuts2)
froutliers
```

#### Figure 8

```{r NUTS2 in Hungary and Slovakia}
#| echo: false
#| label: fig-8
#| fig-cap: "Nuts2 in Hungary and Slovakia"
gdppop %>%
filter(grepl('HU..', Region) | grepl('SK..', Region)) %>%
distinct(nuts2, Year,.keep_all =TRUE) %>%
ggplot(aes(x = Year, y=gini_n2, fill=nuts2, color=nuts2)) +
  geom_line(lwd = .8) +
   labs(title = 'Nuts 2 - Gini in Hungary and Slovakia', x = "Year", y = "Gini")

```

#### Table 16

```{r}
#| echo: false
#| output: true
#| label: tbl-16
#| tbl-cap: "Gini in Hungary"
gdppop %>%
filter(nuts0 == "HU") %>%
select(Year,nuts2, gini_n2) %>%
distinct(nuts2, Year,.keep_all =TRUE) %>%
  filter(Year==2010)
```

#### Table 17

```{r}
#| echo: false
#| output: true
#| label: tbl-17
#| tbl-cap: "Gini in Slovakia"
gdppop %>%
filter(nuts0 == "SK") %>%
select(Year,nuts2, gini_n2) %>%
distinct(nuts2, Year,.keep_all =TRUE) %>%
  filter(Year==2010)
```

#### Table 18

```{r Outliers in Hungary and Slovakia}
#| echo: false
#| output: true
#| label: tbl-18
#| tbl-cap: "Outliers in Hungary and Slovakia"
huskoutliers <- gdppop %>%
   filter (grepl('HU..', Region) | grepl('SK..', Region)) %>%
  filter(gini_n2==0) %>%
  distinct(nuts2)
huskoutliers
```

#### Figure 9

```{r NUTS2 in Portugal}
#| echo: false
#| label: fig-9
#| fig-cap: "Nuts2 in Portugal"
gdppop %>%
filter(nuts0 == "PT") %>%
distinct(nuts2, Year,.keep_all =TRUE) %>%
ggplot(aes(x = Year, y=gini_n2, fill=nuts2, color=nuts2)) +
  geom_line(lwd = .8) +
   labs(title = 'Nuts 2 - Gini in Portugal', x = "Year", y = "Gini")

```

#### Table 19

```{r}
#| echo: false
#| output: true
#| label: tbl-19
#| tbl-cap: "Gini in Portugal"
gdppop %>%
filter(nuts0 == "PT") %>%
select(Year,nuts2, gini_n2) %>%
distinct(nuts2, Year,.keep_all =TRUE) %>%
  filter(Year==2010)
```

#### Table 20

```{r Outliers in Portugal}
#| echo: false
#| output: true
#| label: tbl-20
#| tbl-cap: "Outliers in Portugal"
ptoutliers <- gdppop %>%
  filter(nuts0 == "PT") %>%
  filter(gini_n2==0) %>%
  distinct(nuts2)
ptoutliers
```

**Assignment 2**

#### Figure 10

```{r}
#| echo: false
#| label: fig-10
#| fig-cap: "Gini for all countries "

gdppop2010 <- gdppop2010 %>%
  filter(Gini > 0)
Denmark2010 <- gdppop2010 %>%
  filter(nuts0=="DK") 
France2010 <- gdppop2010 %>%
  filter(nuts0=="FR")
HungarySlovakia2010 <- gdppop2010 %>%
 filter(grepl('HU..', nuts2) | grepl('SK..', nuts2))
Portugal2010 <- gdppop2010 %>%
  filter(nuts0=="PT")
ggplot()+
  geom_point(data = gdppop2010, mapping = aes(x = Gini , y = nuts0))+
  labs(title = "Gini for all countries 2010")

#for alle land i 2010
```

#### Figure 11

Estimate the effect of regional development on regional inequality GINI
for the year 2010

```{r}
#| echo: false
#| label: fig-11
#| fig-cap: "Gini and GDP per capita in 2010 for all countries"
ggplot(gdppop2010, aes(x = gdp_per_capita, y = Gini)) +
  geom_point (lwd=.8) +
  geom_smooth(method = "lm") + 
  labs(x = "GDP per capita 2010", Y = "Gini")+
  labs(title = "Gini and GDP per capita in 2010 for all countries")
```

#### Figure 15

```{r}
#| echo: false
#| label: fig-15
#| fig-cap: "Gini and GDP per capita for France with out Paris"
ggplot(France2010, aes(x = gdp_per_capita, y = Gini)) +
  geom_point() +
  geom_smooth(method = "lm") + 
  labs(title = "Gini and GDP per capita for France",x = "GDP per capita 2010", Y = "Gini")
```

#### Table 21

```{r}
#| echo: false
#| output: true
#| label: tbl-21
#| tbl-cap: "Gini - Edu"
lm(Gini ~ Edu, data = France2010) %>% tidy()%>% kable(., digits=4)
```

#### Table 22

```{r}
#| echo: false
#| output: true
#| label: tbl-22
#| tbl-cap: "Gini -Lea"
lm(Gini ~ lea, data = France2010) %>% tidy()%>% kable(., digits=4)
```

#### Table 23

```{r}
#| echo: false
#| output: true
#| label: tbl-23
#| tbl-cap: "Gini - Road"
lm(Gini ~ Road, data = France2010) %>% tidy()%>% kable(., digits=4)
```

#### Table 24

```{r}
#| echo: false
#| output: true
#| label: tbl-24
#| tbl-cap: "Regression with new variables"
mlrdata <- France2010
lm.3 = lm(Gini2 ~ gdp_per_capita +Edu , mlrdata) 
lm.4 = lm(Gini2 ~ gdp_per_capita + Road, mlrdata)
lm.5 = lm(Gini2 ~ gdp_per_capita + lea, mlrdata)
lm.6 = lm(Gini2 ~ gdp_per_capita + Road + lea + Edu, mlrdata)

#Gen Table
  huxreg(
  list("GDP pc & Education" = lm.3, "GDP pc & Road" = lm.4, "GDP pc & Life expectancy age" = lm.5,"All" = lm.6),
  statistics = c(N = "nobs", R2 = "r.squared"),
  coefs = c(Const. = "(Intercept)", gdp_per_capita= "gdp_per_capita", Education = "Edu", Motorway = "Road", Lifeexp = "lea"),
  stars = c("*" = 0.1, "**" = 0.05, "***" =0.01),
  note = "Note: {stars} T statistics in brackets."
  )

```

#### Table 25

```{r}
#| echo: false
#| output: true
#| label: tbl-25
#| tbl-cap: "Regression with dummies"
gdppop2010 <- gdppop2010
lm.20 = lm(Gini2 ~ gdp_per_capita, filter(gdppop2010, Fra==1))
lm.21 = lm(Gini2 ~ gdp_per_capita, filter(gdppop2010, Fra==0))
lm.22 = lm(Gini2 ~ gdp_per_capita*Fra , gdppop2010)
 
#Gen Table
  huxreg(
  list("Only France" = lm.20, "No France" = lm.21, "Interaction" = lm.22),
  statistics = c("N" = "nobs",
      R2 = "r.squared", "F statistic" = "statistic",
      "P value" = "p.value"),
   stars = c("*" = 0.1, "**" = 0.05, "***" =0.01),
  note = "Note: {stars} T statistics in brackets.")
```

#### Table 26

```{r penal}
#| echo: false
paneldata <- gdppop %>%
  mutate(nuts2 = substr(Region,1,4))%>%
  group_by(nuts2, Year) %>%
  mutate(Gini = gini.wtd(gdp_per_capita, w = Population),
         gdp_n3 = sum(GDP, na.rm=T),
         pop_n3 = sum(Population, na.rm=T)) %>%
  mutate(gdp_n2 = sum(gdp_n3),pop_n2 = sum(pop_n3))%>%
  ungroup() %>%
  #Keeping only 1 obs per NUTS 2
    distinct(Year, nuts2,Gini,gdp_n2,pop_n2) %>%
  mutate(gdp_per_capita = gdp_n2/pop_n2*10000)%>%
  mutate(gdp_per_capita = log(gdp_per_capita))%>%
  mutate(nuts0 = substr(nuts2,1,2))
 
```

```{r}
#| echo: false
#| output: true
#| label: tbl-26
#| tbl-cap: "Panel data"
plm.1 <- paneldata %>%
plm(Gini ~ gdp_per_capita + I(gdp_per_capita^2), data = ., index = c("nuts2"), model="within", effect ="twoways") %>% coeftest(vcov. = vcovHC, type = "HC1", save = TRUE)
 
plm.2 <- paneldata %>%
plm(Gini ~ gdp_per_capita + I(gdp_per_capita^2), data = ., index = c("Year"), model = "within", effect = "twoways") %>% coeftest(vcov. = vcovHC, type = "HC1", save = TRUE)
 
plm.3 <- paneldata %>%
plm(Gini ~ gdp_per_capita + I(gdp_per_capita^2), data = ., index = c("nuts2", "Year"), model="within", effect ="twoways") %>% coeftest(vcov. = vcovHC, type = "HC1", save = TRUE)

plm.4 <- paneldata %>%
plm(Gini ~ gdp_per_capita + I(gdp_per_capita^2), data = ., index = c("nuts0", "Year"), model="within", effect ="twoways") %>% coeftest(vcov. = vcovHC, type = "HC1", save = TRUE)

#Gen Table
  huxreg(
  list("Regio FE" = plm.1, "Year FE" = plm.2, "Regio & Year FE" = plm.3 , "Country & Year FE" = plm.4 ),
  statistics = c(N = "nobs", R2 = "r.squared"),
  stars = c("*" = 0.1, "**" = 0.05, "***" =0.01),
  note = "Note): {stars} T statistics in brackets."
  )
```
